# FocusField Full configuration (3 cameras, 8 microphones) - Pi-optimized
# Use this on Raspberry Pi 5 / Pi-class devices.

build: full

runtime:
  run_id: ""
  fail_fast: true
  enable_validation: true
  artifacts:
    dir: "artifacts"
    retention:
      max_runs: 10

trace:
  enabled: true
  level: medium
  thumbnails:
    enabled: true
    fps: 1
  record_raw_audio: true
  record_heatmap_full: false

health:
  enabled: true
  thresholds_ms:
    audio_frames: 200
    enhanced_final: 300
    face_tracks: 1000
    camera_frame: 1000

perf:
  enabled: true
  emit_hz: 1

audio:
  channels: 8
  sample_rate_hz: 48000
  block_size: 1024
  device_profile: minidsp_uma8_raw_7p1
  capture:
    allow_mono_fallback: false
  device_selector:
    match_substring: "miniDSP"
    require_input_channels: 8
  vad:
    enabled: true
    mode: 1
    frame_ms: 30
    min_speech_ratio: 0.3
  doa:
    method: srp_phat
    bins: 72
    update_hz: 10
  beamformer:
    method: mvdr
    no_lock_behavior: omni
    use_last_lock_ms: 800
    steering_smoothing_alpha: 0.85
    channel_weights:
      enabled: true
      spatial_exponent: 2.0
      dead_rms_threshold: 1.0e-5
      min_snr_db: 3.0
      max_snr_db: 18.0
      max_clip_fraction: 0.01
    noise_reference:
      ref_threshold: 0.2
      update_when_speaking: true
    mvdr:
      nfft: 1024
      refresh_ms: 250
      noise_ema_alpha: 0.95
      diagonal_loading: 1.0e-3
      steering_update_deg: 5.0
      max_condition_number: 1.0e6

  denoise:
    enabled: true
    backend: wiener
    wiener:
      g_min: 0.05
      noise_ema_alpha: 0.98

  sync:
    enabled: true
    drift_check:
      max_offset_samples: 6
      check_every_s: 2.0

video:
  cameras:
    - id: cam0
      device_path: ""
      device_index: 0
      width: 640
      height: 360
      fps: 15
      hfov_deg: 160
      yaw_offset_deg: 0
      bearing_model: linear
      bearing_lut_path: ""
    - id: cam1
      device_path: ""
      device_index: 1
      width: 640
      height: 360
      fps: 15
      hfov_deg: 160
      yaw_offset_deg: 120
      bearing_model: linear
      bearing_lut_path: ""
    - id: cam2
      device_path: ""
      device_index: 2
      width: 640
      height: 360
      fps: 15
      hfov_deg: 160
      yaw_offset_deg: 240
      bearing_model: linear
      bearing_lut_path: ""

vision:
  face:
    min_confidence: 0.6
    iou_threshold: 0.3
    max_missing_frames: 10
    min_area: 800
    min_neighbors: 4
    scale_factor: 1.1
    detect_width: 320
    detect_every_n: 2
  track:
    smoothing_alpha: 0.6
    max_missing_frames: 10
    min_age_frames: 2
  mouth:
    smoothing_alpha: 0.5
    min_activity: 0.02
    max_activity: 0.2
    diff_threshold: 4
    use_facemesh: false
    mesh_every_n: 2
    mesh_max_faces: 3
    mesh_min_detection_confidence: 0.5
    mesh_min_tracking_confidence: 0.5
    mesh_min_activity: 0.005
    mesh_max_activity: 0.1
    mesh_model_path: ""
  heatmap:
    bin_size_deg: 10
    sigma_deg: 18
    top_k_peaks: 2
    smoothing_alpha: 0.25

fusion:
  thresholds_preset: balanced
  require_vad: true
  vad_max_age_ms: 500
  require_speaking: true

bus:
  max_queue_depth: 8

logging:
  level: info
  file:
    enabled: true
    flush_interval_ms: 200
    rotate_mb: 50

output:
  sink: file
  file_sink:
    dir: "artifacts"
    write_raw_multich: true

ui:
  host: 127.0.0.1
  port: 8080
  telemetry_hz: 10
